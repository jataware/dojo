"use strict";(self.webpackChunkdojo_docs_v_2=self.webpackChunkdojo_docs_v_2||[]).push([[729],{7136:(e,d,n)=>{n.r(d),n.d(d,{assets:()=>s,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var t=n(5893),o=n(1151);const i={layout:"default",title:"Dojo API",has_toc:!0},r="The Dojo API",l={id:"dojo-api",title:"Dojo API",description:"This document outlines how to interact with the Dojo API to fetch models, execute models, and fetch model runs.",source:"@site/docs/dojo-api.md",sourceDirName:".",slug:"/dojo-api",permalink:"/dojo/dojo-api",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{layout:"default",title:"Dojo API",has_toc:!0},sidebar:"dojoSidebar",previous:{title:"Aggregation Methods",permalink:"/dojo/details/aggregation-methods"},next:{title:"Documents",permalink:"/dojo/documents"}},s={},c=[{value:"Model Discovery",id:"model-discovery",level:2},{value:"Model Execution",id:"model-execution",level:2},{value:"Retrieving Detached Model Runs",id:"retrieving-detached-model-runs",level:2},{value:"Debugging Model Runs",id:"debugging-model-runs",level:2},{value:"Searching for Model Runs",id:"searching-for-model-runs",level:2},{value:"Working with Model Results",id:"working-with-model-results",level:2}];function a(e){const d={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.h1,{id:"the-dojo-api",children:"The Dojo API"}),"\n",(0,t.jsx)(d.p,{children:"This document outlines how to interact with the Dojo API to fetch models, execute models, and fetch model runs."}),"\n",(0,t.jsx)(d.h2,{id:"model-discovery",children:"Model Discovery"}),"\n",(0,t.jsxs)(d.p,{children:["You can search Dojo for models using the ",(0,t.jsx)(d.code,{children:"GET /models"}),". For example, to find models related to ",(0,t.jsx)(d.code,{children:"crops"})," you would send:"]}),"\n",(0,t.jsx)(d.pre,{children:(0,t.jsx)(d.code,{children:"curl -X 'GET' \\\n  'https://api.dojo-modeling.com/models?query=crops&size=10' \\\n  -H 'accept: application/json'\n"})}),"\n",(0,t.jsx)(d.p,{children:"This will return an array of model objects defined by the Dojo model schema."}),"\n",(0,t.jsx)(d.p,{children:"A key thing to note is that each model has as a set of parameters. Parameters are model specific and the model metadata will include default values for each parameter. Understanding a model's individual parameters is crucial for executing a model."}),"\n",(0,t.jsxs)(d.p,{children:["Additionally, you may retrieve models directly based on their ",(0,t.jsx)(d.code,{children:"id"}),". For example, here we retrieve DSSAT based on its ",(0,t.jsx)(d.code,{children:"id"}),":"]}),"\n",(0,t.jsx)(d.pre,{children:(0,t.jsx)(d.code,{children:"curl -X 'GET' \\\n  'https://api.dojo-modeling.com/models/5cf84e06-c1ce-4a9d-a2e6-ede687293a26' \\\n  -H 'accept: application/json'\n"})}),"\n",(0,t.jsx)(d.h2,{id:"model-execution",children:"Model Execution"}),"\n",(0,t.jsxs)(d.p,{children:["To execute a model, We use ",(0,t.jsx)(d.code,{children:"runmodel"})," from the ",(0,t.jsx)(d.a,{href:"https://github.com/dojo-modeling/dojo-cli#runmodel",children:"dojo-cli"}),"."]}),"\n",(0,t.jsx)(d.p,{children:"First, you must obtain the model's metadata to appropriately set the model's parameters. Any parameter not explicitly set will fall back to its default setting which was specified at the time of model registration."}),"\n",(0,t.jsx)(d.p,{children:"Let's say we wish to execute DSSAT with the following parameters:"}),"\n",(0,t.jsxs)(d.ul,{children:["\n",(0,t.jsx)(d.li,{children:"Fertilizer amount addition: 25 kg[N]/ha"}),"\n",(0,t.jsx)(d.li,{children:"Rainfall multiplier: 1.25"}),"\n",(0,t.jsx)(d.li,{children:"Offset to planting date window: 30 days"}),"\n"]}),"\n",(0,t.jsx)(d.p,{children:(0,t.jsx)(d.code,{children:'dojo runmodel --model="DSSAT" --params=\'{"fertilizer_amount_addition": 25, "rainfall_multiplier": 1.25, "offset_to_planting_date_window": 30}\''})}),"\n",(0,t.jsx)(d.p,{children:'Your model will now run in "attached mode". The normal output generated by the model will be displayed on the screen and the command will run until the model completes. Details will be provided at the end of the run which will indicate where all of the generated files have been located on your local system.'}),"\n",(0,t.jsxs)(d.p,{children:['You can also run in "detached mode" by adding ',(0,t.jsx)(d.code,{children:"--attached=False"})," to the arguments above. In this case, the model will run in the background and you must retreive your run results when they complete."]}),"\n",(0,t.jsx)(d.h2,{id:"retrieving-detached-model-runs",children:"Retrieving Detached Model Runs"}),"\n",(0,t.jsxs)(d.p,{children:["To retrieve results. We use ",(0,t.jsx)(d.code,{children:"results"})," from the ",(0,t.jsx)(d.a,{href:"https://github.com/dojo-modeling/dojo-cli#results",children:"dojo-cli"})]}),"\n",(0,t.jsx)(d.pre,{children:(0,t.jsx)(d.code,{children:"--id : id of the docker container\n--name : name of the docker container (as returned by the runmodel command)\n--config : name of configuation file; defaults to .config\n"})}),"\n",(0,t.jsx)(d.p,{children:(0,t.jsx)(d.code,{children:"dojo results --name=dojo-DSSAT20211227140758"})}),"\n",(0,t.jsx)(d.pre,{children:(0,t.jsx)(d.code,{children:'Run completed.\nModel output, run-parameters, and log files are located in "/mydojodata/runs/DSSAT/33cf1a60-2544-420f-ae08-b453a9751cfc/20211227140758".\n'})}),"\n",(0,t.jsx)(d.h2,{id:"debugging-model-runs",children:"Debugging Model Runs"}),"\n",(0,t.jsxs)(d.p,{children:["After using ",(0,t.jsx)(d.code,{children:"runmodel"})," from the ",(0,t.jsx)(d.a,{href:"https://github.com/dojo-modeling/dojo-cli#runmodel",children:"dojo-cli"}),", you can debug model runs by fetching the model execution logs. go to the log locations ",(0,t.jsx)(d.code,{children:"/runs/{model-name}/{uuid}/logs.txt"})]}),"\n",(0,t.jsx)(d.h2,{id:"searching-for-model-runs",children:"Searching for Model Runs"}),"\n",(0,t.jsxs)(d.p,{children:["To print a description of the model, we use ",(0,t.jsx)(d.code,{children:"describe"})," from the ",(0,t.jsx)(d.a,{href:"https://github.com/dojo-modeling/dojo-cli#describe",children:"dojo-cli"})]}),"\n",(0,t.jsx)(d.p,{children:"For example, we can query for:"}),"\n",(0,t.jsxs)(d.ul,{children:["\n",(0,t.jsx)(d.li,{children:"model_name: Population Model"}),"\n"]}),"\n",(0,t.jsx)(d.p,{children:(0,t.jsx)(d.code,{children:'dojo describe --model="Population Model"'})}),"\n",(0,t.jsx)(d.pre,{children:(0,t.jsx)(d.code,{children:"NAME\n----\nPopulation Model\n\nMODEL FAMILY\n------------\nKimetrica\n\nDESCRIPTION\n-----------\nThe population model serves as an ancillary tool to distribute, disaggregate yearly population projections onto a geospatial representation. Occasionally, the output of this model is required as an independent variable for downstream models.y\n...\n"})}),"\n",(0,t.jsx)(d.h2,{id:"working-with-model-results",children:"Working with Model Results"}),"\n",(0,t.jsxs)(d.p,{children:["Model results are stored in the ",(0,t.jsx)(d.a,{href:"details/geotemporal-format",children:"Geotemporal format"}),". They can be interacted with conveniently using Python's Pandas library, or any other library used to process parquet."]}),"\n",(0,t.jsx)(d.p,{children:"For example:"}),"\n",(0,t.jsx)(d.pre,{children:(0,t.jsx)(d.code,{children:'import pandas as pd\n\ndata_path = "./mydojodata/runs/DSSAT/33cf1a60-2544-420f-ae08-b453a9751cfc/20211227140758/example-run-8654912_5cf84e06-c1ce-4a9d-a2e6-ede687293a26.1.parquet.gzip"\n\ndf = pd.read_parquet(data_path)\n\nprint(df.head())\n'})}),"\n",(0,t.jsx)(d.p,{children:"This will return:"}),"\n",(0,t.jsxs)(d.table,{children:[(0,t.jsx)(d.thead,{children:(0,t.jsxs)(d.tr,{children:[(0,t.jsx)(d.th,{children:"timestamp"}),(0,t.jsx)(d.th,{children:"country"}),(0,t.jsx)(d.th,{children:"admin1"}),(0,t.jsx)(d.th,{children:"admin2"}),(0,t.jsx)(d.th,{children:"admin3"}),(0,t.jsx)(d.th,{children:"lat"}),(0,t.jsx)(d.th,{children:"lng"}),(0,t.jsx)(d.th,{children:"feature"}),(0,t.jsx)(d.th,{children:"value"})]})}),(0,t.jsxs)(d.tbody,{children:[(0,t.jsxs)(d.tr,{children:[(0,t.jsx)(d.td,{children:"1546300800000"}),(0,t.jsx)(d.td,{children:"Kenya"}),(0,t.jsx)(d.td,{children:"Kericho"}),(0,t.jsx)(d.td,{children:"Bureti"}),(0,t.jsx)(d.td,{children:"Kisiara"}),(0,t.jsx)(d.td,{children:"-0.458"}),(0,t.jsx)(d.td,{children:"35.125"}),(0,t.jsx)(d.td,{children:"HDAT_AVE"}),(0,t.jsx)(d.td,{children:"1566259200000"})]}),(0,t.jsxs)(d.tr,{children:[(0,t.jsx)(d.td,{children:"1577836800000"}),(0,t.jsx)(d.td,{children:"Kenya"}),(0,t.jsx)(d.td,{children:"Kericho"}),(0,t.jsx)(d.td,{children:"Bureti"}),(0,t.jsx)(d.td,{children:"Kisiara"}),(0,t.jsx)(d.td,{children:"-0.458"}),(0,t.jsx)(d.td,{children:"35.125"}),(0,t.jsx)(d.td,{children:"HDAT_AVE"}),(0,t.jsx)(d.td,{children:"1599264000000"})]}),(0,t.jsxs)(d.tr,{children:[(0,t.jsx)(d.td,{children:"441763200000"}),(0,t.jsx)(d.td,{children:"Kenya"}),(0,t.jsx)(d.td,{children:"Nyamira"}),(0,t.jsx)(d.td,{children:"North Mugirango"}),(0,t.jsx)(d.td,{children:"Magwagwa"}),(0,t.jsx)(d.td,{children:"-0.458"}),(0,t.jsx)(d.td,{children:"35.042"}),(0,t.jsx)(d.td,{children:"HDAT_AVE"}),(0,t.jsx)(d.td,{children:"461462400000"})]}),(0,t.jsxs)(d.tr,{children:[(0,t.jsx)(d.td,{children:"473385600000"}),(0,t.jsx)(d.td,{children:"Kenya"}),(0,t.jsx)(d.td,{children:"Nyamira"}),(0,t.jsx)(d.td,{children:"North Mugirango"}),(0,t.jsx)(d.td,{children:"Magwagwa"}),(0,t.jsx)(d.td,{children:"-0.458"}),(0,t.jsx)(d.td,{children:"35.042"}),(0,t.jsx)(d.td,{children:"HDAT_AVE"}),(0,t.jsx)(d.td,{children:"495504000000"})]}),(0,t.jsxs)(d.tr,{children:[(0,t.jsx)(d.td,{children:"504921600000"}),(0,t.jsx)(d.td,{children:"Kenya"}),(0,t.jsx)(d.td,{children:"Nyamira"}),(0,t.jsx)(d.td,{children:"North Mugirango"}),(0,t.jsx)(d.td,{children:"Magwagwa"}),(0,t.jsx)(d.td,{children:"-0.458"}),(0,t.jsx)(d.td,{children:"35.042"}),(0,t.jsx)(d.td,{children:"HDAT_AVE"}),(0,t.jsx)(d.td,{children:"526608000000"})]}),(0,t.jsxs)(d.tr,{children:[(0,t.jsx)(d.td,{children:"536457600000"}),(0,t.jsx)(d.td,{children:"Kenya"}),(0,t.jsx)(d.td,{children:"Nyamira"}),(0,t.jsx)(d.td,{children:"North Mugirango"}),(0,t.jsx)(d.td,{children:"Magwagwa"}),(0,t.jsx)(d.td,{children:"-0.458"}),(0,t.jsx)(d.td,{children:"35.042"}),(0,t.jsx)(d.td,{children:"HDAT_AVE"}),(0,t.jsx)(d.td,{children:"557366400000"})]})]})]})]})}function h(e={}){const{wrapper:d}={...(0,o.a)(),...e.components};return d?(0,t.jsx)(d,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},1151:(e,d,n)=>{n.d(d,{Z:()=>l,a:()=>r});var t=n(7294);const o={},i=t.createContext(o);function r(e){const d=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(d):{...d,...e}}),[d,e])}function l(e){let d;return d=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(i.Provider,{value:d},e.children)}}}]);